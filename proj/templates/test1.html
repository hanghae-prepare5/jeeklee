<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" ,>


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

    <title>OOTDGRAM</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

</head>


<style>
    .all {


    }

    /*ë¡œê³ ì—¬ë°±*/
    .top {
        margin: 20px 20px 20px 20px;
        padding: 0px 0px 0px 0px;
        border-bottom: solid 2px whitesmoke;


    }

    /*ë¡œê³ */
    .logo {
        color: gray;
        height: 60px;
        margin: auto;
        font-size: 35px;
        text-align: center;
        width: 400px;


    }

    /*ë’¤ë¡œê°€ê¸°ë²„íŠ¼*/
    .back-btn {
        border: 10px solid transparent;
        border-radius: 18px;
        font-size: 30px;
        position: fixed;
    }

    /*ìœ ì €ì•„ì´ë””*/
    .userid {
        float: right;
        margin-right: 10%;
        margin-top: 50px;
        margin-left: 8px;
        font-size: 25px;
    }

    /*í”„ë¡œí•„ë²„íŠ¼ ë§ˆì´í˜ì´ì§€ ì´ë™ */
    .profile {
        overflow: hidden;
        float: right;
        width: 135px;
        height: 135px;
        border-radius: 100%;
        border: none;


    }

    /*í”„ë¡œí•„ì‚¬ì§„*/
    .profile-photo {

        width: 130px;

        height: 135px;

        color: red;

        object-fit: cover;
        border-radius: 100px;


    }


    /*ì‚¬ì´ì—¬ë°±*/
    .middle {
        margin-bottom: 255px;

    }

    /*ì •ë ¬ë²„íŠ¼*/
    .npbutton {

        margin-left: 125px;
        margin-bottom: 10px;
        margin-top: 10px;
        width: 95%;
    }

    /*ì •ë ¬ë²„íŠ¼ ìƒë‹¨ ì¤„*/
    .classificaftion {

        width: 100%;
        border-top: solid 2px whitesmoke;


    }

    /*ê²Œì‹œë²„íŠ¼*/
    .upload {
        margin-left: 70%;


        background-color: white;

        border: none;
        font-size: 28px;
    }

    /*ê²Œì‹œë¬¼ë°•ìŠ¤*/
    .posts-box {


    }

    /*ê²Œì‹œë¬¼*/
    .post {
        float: left;
        margin-right: 2%;
        margin-left: 8%;
        margin-top: 15px;
        margin-bottom: 15px;
        display: flex;
        flex-wrap: wrap;


    }

    /*ì¢‹ì•„ìš”ë²„íŠ¼*/
    .like {
        border: none;
        background-color: white;
        margin-left: 90%;
        font-size: 23px;
    }

    /*ê²Œì‹œë¬¼ì‚¬ì§„*/
    .card {
        width: 530px;
        height: auto;


    }


    /*ê²Œì‹œë¬¼ì‘ì„±css*/
    #noticepopup {
        position: absolute;
        width: 100%;
        height: 100%;
        display: none;
    }

    .black {
        background: rgba(0, 0, 0, 0.6);
    }

    .noticepost {
        width: 504px;
        height: 850px;


        display: flex;
        flex-direction: column;
        justify-content: left;
        align-items: normal;

        border: 2px solid black;
        border-radius: 3%;
        margin: auto;

        background-color: white;
    }

    .noticeposttop {
        display: flex;
        flex-direction: row;
        justify-content: left;
        align-items: center;

        margin: 10px;
    }

    .noticeposttop_btn {
        margin-left: auto;
        margin-bottom: auto;
    }

    .noticeprofile {
        width: 70px;
        height: 70px;

        border-radius: 100%;
        border: 1px solid black;

        background-position: center;
        background-size: cover;

        margin-right: 10px;

    }

    .noticeuser {
        display: flex;
        flex-direction: row;
        justify-content: left;
        align-items: center;
    }

    .noticepicture {
        background-color: white;


        width: 500px;
        height: 502px;


        border-top: 1px solid black;
        border-bottom: 1px solid black;

        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .noticepostbottom {

        display: flex;
        flex-direction: column;
        justify-content: right;
        align-items: normal;

        margin: 10px;
    }

    .noticebtn_upload {
        margin-top: 10px;

        display: flex;
        flex-direction: column;
        align-items: flex-end;
    }

    .fileuproadhide {

        display: none;
    }

    .filebox {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
    }

    .imagepopup {
        position: absolute;

        width: 500px;
        height: 500px;

        display: none;
        margin-bottom: 38px;
    }

    .imagepopupsize {
        width: 500px;
        height: 500px;
    }


</style>

<script>
    $(document).ready(function () {
        show_post();
    });

    function show_post() {
        $.ajax({
            type: "GET",
            url: "/main",
            data: {},
            success: function (response) {
                let rows = response['post_list']
                console.log(rows)
                for (let i = 0; i < rows.length; i++) {
                    let id = rows[i]['user_pk']
                    let text = rows[i]['text']
                    let tags = rows[i]['tags']
                    let image = rows[i]['image']
                    let time = rows[i]['write_date']
                    let like = rows[i]['like']
                    let post = rows[i]['postwrite_pk']

                    let temp_post = `<div id="post" class="post">
                                    <div class="card">
                                <div class="postimg">
                                    <a href='/post/${post}?post=${post}'>
                                        <img class="card-img-top" src=${image}
                                           alt="...">  </div>
                                    </a>
                                <div class="card-body">
                                    <h5 class="card-title">${id}</h5>
                                    <button class="like">â™¡ï¸<h9>${like}</h9></button>
                                    <p class="card-text">${text}</p>
                                    <p class="card-text">  ${tags}   </p>
                                    <p> ${time} </p>
                                </div></div></div>
                            `
                    $('#post').append(temp_post)


                }
            }
        });
    }

    //ê²Œì‹œë¬¼ì‘ì„± JS

    //ê²Œì‹œë¬¼ì‘ì„± íŒì—… ì—´ê¸°
    $(document).ready(function () {
        $("#noticewrite").click(function () {
            $("#noticepopup").fadeIn();
            $("#noticepopup").addClass("black");
        });
        //ê²Œì‹œë¬¼ì‘ì„± íŒì—… ë‹«ê¸°
        $("#popupclose").click(function () {
            $(this).parent().parent().parent().parent().fadeOut();
        });
    });
    //ì‚¬ì§„ íŒì—… ì—´ê¸°
    $(document).ready(function () {
        $(document).on("click", ".btn-open", function () {
            $("#imagepopup").fadeIn();
        });
    });

    //ì‚¬ì§„ íŒì—… ë‹«ê¸°
    function image() {
        $("#imagepopup").fadeOut()
    }

    var fileNo = 0;
    var filesArr = new Array();

    var dataURL

    /* ì²¨ë¶€íŒŒì¼ ì¶”ê°€ */
    function addFile(obj) {
        var maxFileCnt = 1;   // ì²¨ë¶€íŒŒì¼ ìµœëŒ€ ê°œìˆ˜
        var attFileCnt = document.querySelectorAll('.filebox').length;    // ê¸°ì¡´ ì¶”ê°€ëœ ì²¨ë¶€íŒŒì¼ ê°œìˆ˜
        var remainFileCnt = maxFileCnt - attFileCnt;    // ì¶”ê°€ë¡œ ì²¨ë¶€ê°€ëŠ¥í•œ ê°œìˆ˜
        var curFileCnt = obj.files.length;  // í˜„ì¬ ì„ íƒëœ ì²¨ë¶€íŒŒì¼ ê°œìˆ˜

        // ì²¨ë¶€íŒŒì¼ ê°œìˆ˜ í™•ì¸
        if (curFileCnt > remainFileCnt) {
            alert("ì²¨ë¶€íŒŒì¼ì€ ìµœëŒ€ " + maxFileCnt + "ê°œ ê¹Œì§€ ì²¨ë¶€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        } else {
            for (const file of obj.files) {
                // ì²¨ë¶€íŒŒì¼ ê²€ì¦
                if (validation(file)) {
                    // íŒŒì¼ ë°°ì—´ì— ë‹´ê¸°
                    var reader = new FileReader();
                    reader.onload = function () {
                        filesArr.push(file);
                        // ì´ë¯¸ì§€ íŒŒì¼ ì´ë¯¸ì§€í™”
                        dataURL = reader.result;
                        var imagepopupshow = document.getElementById('imagepopupshow');
                        imagepopupshow.src = dataURL;

                    };
                    reader.readAsDataURL(file);

                    // ëª©ë¡ ì¶”ê°€
                    let htmlData = '';
                    htmlData += '<div id="file' + fileNo + '" class="filebox">';
                    htmlData += '   <a href="#" class="btn-open">' + file.name + '</a>';
                    htmlData += '   <a  onclick="deleteFile(' + fileNo + ');"><button type="button" class="btn-close" aria-label="Close"></button></a>';
                    htmlData += '   <div class="imagepopup" id="imagepopup" type="button" onclick="image()">';
                    htmlData += '       <img id="imagepopupshow" class="imagepopupsize">';
                    htmlData += '   </div>';
                    htmlData += '</div>';
                    $('.file-list').append(htmlData);
                    fileNo++;
                } else {
                    continue;
                }

            }
        }
        // ì´ˆê¸°í™”
        document.querySelector("input[type=file]").value = "";
    }

    console.log($('#imagepopupshow'))


    /* ì²¨ë¶€íŒŒì¼ ê²€ì¦ */
    function validation(obj) {
        const fileTypes = ['application/pdf', 'image/gif', 'image/jpeg', 'image/png', 'image/bmp', 'image/tif', 'application/haansofthwp', 'application/x-hwp'];
        if (obj.name.length > 100) {
            alert("íŒŒì¼ëª…ì´ 100ì ì´ìƒì¸ íŒŒì¼ì€ ì œì™¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
            return false;
        } else if (obj.size > (100 * 1024 * 1024)) {
            alert("ìµœëŒ€ íŒŒì¼ ìš©ëŸ‰ì¸ 100MBë¥¼ ì´ˆê³¼í•œ íŒŒì¼ì€ ì œì™¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
            return false;
        } else if (obj.name.lastIndexOf('.') == -1) {
            alert("í™•ì¥ìê°€ ì—†ëŠ” íŒŒì¼ì€ ì œì™¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
            return false;
        } else if (!fileTypes.includes(obj.type)) {
            alert("ì²¨ë¶€ê°€ ë¶ˆê°€ëŠ¥í•œ íŒŒì¼ì€ ì œì™¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
            return false;
        } else {
            return true;
        }
    }

    /* ì²¨ë¶€íŒŒì¼ ì‚­ì œ */
    function deleteFile(num) {
        document.querySelector("#file" + num).remove();
        filesArr[num].is_delete = true;
    }


    function save_Postwrite() {

        // // tags ì¡°ê±´ìœ¼ë¡œ ì–´ë–¤ê°’ì´ë“  ê· ì¼í•˜ê²Œ ë³€ê²½ì‹œí‚¤ê¸°
        let tagsedit1 = $('#floatingTextarea').val();
        for (var i = 0; i < tagsedit1.length; i++) {
            if (tagsedit1[i] === ' ') {
                tagsedit1.splice(i, 1);
                i--;
            }
        }
        let tagsedit2 = tagsedit1.join('')

        let tagsedit3 = tagsedit2.split(',')
        let tagsedit4 = tagsedit3.join('')
        let tagsedit5 = tagsedit4.split('#')
        for (var i = 0; i < tagsedit5.length; i++) {
            if (tagsedit5[i] === '') {
                tagsedit5.splice(i, 1);
                i--;
            }
        }
        let tagsedit6 = tagsedit5.join('-')

        /* í¼ ì „ì†¡ */
        // í¼ë°ì´í„° ë‹´ê¸°
        let tags = tagsedit6
        let text = $('#floatingTextarea2').val()
        let write_date = new Date();
        let image = dataURL;

        $.ajax({
            type: "POST",
            url: "/Postwrite",
            data: {image_give: image, tags_give: tags, text_give: text, write_date_give: write_date},

            success: function (response) {
                alert(response["msg"])
                window.location.reload()
            },
        });
    }

    $(document).ready(function () {
        show_profile();
    });

    function show_profile() {
        $.ajax({
            type: "GET",
            url: "/Postwrite",
            data: {},
            success: function (response) {
                console.log(response['User'])
                let rows = response['User']
                for (let i = 0; i < rows.length; i++) {
                    let id = rows[i]['id']
                    let profile = rows[i]['profile']


                    let temp_html = `<img src="${profile}" class="noticeprofile">
                                         <div>${id}</div>`

                    $('#noticeuser').append(temp_html)
                }
            }
        });
    }


</script>


<body>
<div style="display: flex;flex-direction: column;justify-content: normal;align-items: normal ;">
    <div class="all">
        <!--ë¡œê³ -->
        <div style="float:top;" class='top'>
            <h1 class='logo'>OOTD_GRAM</h1>
        </div>
        <!--ë’¤ë¡œê°€ê¸° ë²„íŠ¼-->
        <div>
            <button onclick="history.back()" type="button" class="back-btn">ğŸ”™</button>
        </div>
        <!--ìœ ì €ì•„ì´ë”” ë° í”„ë¡œí•„-->
        <div>
            <h1 class="userid"> User_ID </h1> <!--comments_id -->
            <!-- comments_profile / ë§ˆì´í˜ì´ì§€ ì´ë™ -->
            <button onclick="location.href='mypage'" class="profile" type="button"><img class="profile-photo"
                                                                                        src="https://newsimg.sedaily.com/2020/11/24/1ZAJ728KBG_1.jpg">
                <!--í”„ë¡œí•„-->
            </button>
        </div>
        <div class="middle"> <!--ì‚¬ì´ê³µë°±-->
        </div>

        <div class="classificaftion">
            <div class="npbutton"> <!--ì •ë ¬ë²„íŠ¼-->
                <button type="button" class="btn btn-success">NEW</button>
                <button type="button" class="btn btn-danger">POPULAR</button>
                <!--ê²Œì‹œë¬¼ ì‘ì„± í˜ì´ì§€ ì´ë™-->
                <button id="noticewrite" class="upload" type="button" class="btn btn-dark">â•</button>
            </div>
        </div>
        <!--ê²Œì‹œë¬¼ë°•ìŠ¤-->
        <div class="posts-box">
            <div id="post" class="post">

            </div>
        </div>
    </div>

    <!--ê²Œì‹œë¬¼ì‘ì„± html-->
    <div id="noticepopup">
        <div>
            <div class="noticepost">
                <div class="noticeposttop">
                    <!--                //ìœ ì €í”„ë¡œí•„andë‹‰ë„¤ì„-->
                    <div id="noticeuser" class="noticeuser">

                    </div>
                    <div id="popupclose" class="noticeposttop_btn">
                        <button type="button" class="btn-close" aria-label="Close"></button>
                    </div>
                </div>

                <div class="noticepicture">
                    <form method="POST" onsubmit="return false;" enctype="multipart/form-data">
                        <label for="chooseFile">
                            <div type="button" class="btn btn-outline-primary">ì‚¬ì§„ì²¨ë¶€</div>
                        </label>
                        <div class="fileuproadhide">
                            <input id="chooseFile" type="file" onchange="addFile(this);" multiple/>
                        </div>
                        <!--                    //íŒŒì¼ì²¨ë¶€ë¦¬ìŠ¤íŠ¸-->
                        <div class="file-list">

                        </div>

                    </form>
                </div>

                <div class="noticepostbottom">
                    <div>
                        <div class="form-floating">
                        <textarea class="form-control" placeholder="Leave a comment here"
                                  id="floatingTextarea"></textarea>
                            <label for="floatingTextarea">tag(ë°˜ë“œì‹œ #ë¶™í˜€ì„œ ì…ë ¥ ex.[#ë¶€ì‚° #ì¸ì²œ])</label>
                        </div>
                    </div>
                    <div>
                        <div class="form-floating">
                        <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea2"
                                  style="height: 100px"></textarea>
                            <label for="floatingTextarea2">ê²Œì‹œê¸€ ì…ë ¥</label>
                        </div>
                    </div>
                    <div class="noticebtn_upload">
                        <button type="button" class="btn btn-outline-dark" onclick="save_Postwrite()">ê²Œì‹œí•˜ê¸°</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>